<div class="content-header">
  <h2>Year-End Closing Wizard</h2>
  <p class="content-subtitle">Complete these steps to close out the year</p>
</div>

<div class="wizard-progress">
  <div class="wizard-progress-bar" id="wizardProgressBar" style="width: 20%;"></div>
  <div class="wizard-steps">
    <div class="wizard-step active" id="wizardStep1" onclick="goToWizardStep(1)">
      <span class="step-num">1</span>
      <span class="step-label">Review</span>
    </div>
    <div class="wizard-step" id="wizardStep2" onclick="goToWizardStep(2)">
      <span class="step-num">2</span>
      <span class="step-label">Reports</span>
    </div>
    <div class="wizard-step" id="wizardStep3" onclick="goToWizardStep(3)">
      <span class="step-num">3</span>
      <span class="step-label">Archive</span>
    </div>
    <div class="wizard-step" id="wizardStep4" onclick="goToWizardStep(4)">
      <span class="step-num">4</span>
      <span class="step-label">Backup</span>
    </div>
    <div class="wizard-step" id="wizardStep5" onclick="goToWizardStep(5)">
      <span class="step-num">5</span>
      <span class="step-label">Complete</span>
    </div>
  </div>
</div>

<div class="wizard-panel" id="wizardPanel1">
  <div class="card">
    <div class="card-header">
      <h3 style="margin: 0;">Step 1: Review Issues Before Closing</h3>
    </div>
    <div class="card-content" id="reviewIssuesContent">
      <div class="loading-state">
        <span class="loading-spinner"></span>
        <span>Loading issues to review...</span>
      </div>
    </div>
    <div class="card-footer">
      <button class="btn btn-secondary" onclick="refreshReviewIssues()">Refresh</button>
      <button class="btn btn-primary" onclick="completeStep(1)">Continue to Reports</button>
    </div>
  </div>
</div>

<div class="wizard-panel" id="wizardPanel2" style="display: none;">
  <div class="card">
    <div class="card-header">
      <h3 style="margin: 0;">Step 2: Generate Annual Reports</h3>
    </div>
    <div class="card-content" id="reportsContent">
      <div class="loading-state">
        <span class="loading-spinner"></span>
        <span>Generating reports...</span>
      </div>
    </div>
    <div class="card-footer">
      <button class="btn btn-secondary" onclick="goToWizardStep(1)">Back</button>
      <button class="btn btn-primary" id="exportReportsBtn" onclick="exportReportsToDrive()" disabled>Export to Drive and Continue</button>
    </div>
  </div>
</div>

<div class="wizard-panel" id="wizardPanel3" style="display: none;">
  <div class="card">
    <div class="card-header">
      <h3 style="margin: 0;">Step 3: Archive Old Data</h3>
    </div>
    <div class="card-content" id="archiveContent">
      <div class="archive-info">
        <p>This step will move completed orders and OT data from prior years to archive sheets.</p>
        <ul>
          <li>Completed uniform orders go to Archive_Orders_YEAR</li>
          <li>Old OT records go to Archive_OT_YEAR</li>
          <li>Archives are read-only for historical reference</li>
        </ul>
        <div class="warning-box" style="margin-top: 16px;">
          <strong>Note:</strong> Only data from years prior to this year will be archived. Current year data remains in the main sheets.
        </div>
      </div>
      <div id="archiveResults" style="display: none;"></div>
    </div>
    <div class="card-footer">
      <button class="btn btn-secondary" onclick="goToWizardStep(2)">Back</button>
      <button class="btn btn-primary" id="runArchiveBtn" onclick="runArchive()">Run Archive and Continue</button>
    </div>
  </div>
</div>

<div class="wizard-panel" id="wizardPanel4" style="display: none;">
  <div class="card">
    <div class="card-header">
      <h3 style="margin: 0;">Step 4: Create Year-End Backup</h3>
    </div>
    <div class="card-content" id="backupContent">
      <div class="backup-info">
        <p>This creates a complete backup of all system data in Google Drive.</p>
        <ul>
          <li>All sheets exported as CSV files</li>
          <li>Manifest file with backup details</li>
          <li>Stored in: Payroll_System_Backups/Year_End_YEAR</li>
        </ul>
      </div>
      <div id="backupResults" style="display: none;"></div>
    </div>
    <div class="card-footer">
      <button class="btn btn-secondary" onclick="goToWizardStep(3)">Back</button>
      <button class="btn btn-primary" id="runBackupBtn" onclick="runYearEndBackup()">Create Backup and Continue</button>
    </div>
  </div>
</div>

<div class="wizard-panel" id="wizardPanel5" style="display: none;">
  <div class="card">
    <div class="card-header" style="background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); color: white;">
      <h3 style="margin: 0;">Year-End Closing Complete!</h3>
    </div>
    <div class="card-content" id="completionContent">
      <div class="completion-summary">
        <div class="success-icon" style="font-size: 64px; text-align: center;">&#10004;</div>
        <h2 style="text-align: center;">All Steps Completed</h2>
        <p style="text-align: center;">The year-end closing process has been successfully completed.</p>
        <div class="summary-stats" id="completionStats"></div>
        <div class="action-buttons" style="margin-top: 24px; text-align: center;">
          <button class="btn btn-secondary" onclick="sendSummaryEmail()">Send Summary Email</button>
          <button class="btn btn-primary" onclick="loadView('dashboard')">Go to Dashboard</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="exportSuccessModal" style="display: none;">
  <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header" style="background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); color: white;">
      <h3>Export Complete</h3>
    </div>
    <div class="modal-body" style="text-align: center; padding: 24px;">
      <div style="font-size: 48px; margin-bottom: 16px;">&#128193;</div>
      <p style="font-size: 16px; margin-bottom: 8px;"><strong>Files saved to Google Drive:</strong></p>
      <div id="exportedFilesList" style="text-align: left; background: #F3F4F6; padding: 12px; border-radius: 8px; margin: 16px 0;"></div>
      <p style="font-size: 14px; color: #6B7280;">Folder: <strong id="exportFolderName"></strong></p>
      <a id="exportFolderLink" href="#" target="_blank" class="btn btn-secondary" style="margin-top: 12px;">Open in Drive</a>
    </div>
    <div class="modal-footer" style="justify-content: center;">
      <button class="btn btn-primary" onclick="closeExportModal()">Close</button>
    </div>
  </div>
</div>

